# MINIMAL CONFIGURATION FOR TESTING
site:
  id: "TEST_SITE"
  name: "Test Lab"
  location:
    address: "Office Lab"
  timezone: "Africa/Lagos"

transformer:
  type: "Test Unit"
  rating_kva: 100

thermal_camera:
  model: "MLX90640"
  i2c_address: 0x33
  i2c_bus: 1
  refresh_rate: 8
  resolution: [32, 24]
  emissivity: 0.95
  rotation: 0  # 0, 90, 180, or 270 degrees

# DEFAULT ROIs - Will be replaced by visual mapper
regions_of_interest:
  - name: "full_frame"
    enabled: true
    coordinates: [[0, 0], [32, 24]]
    weight: 1.0
    emissivity: 0.95
    thresholds:
      warning: 75.0
      critical: 85.0
      emergency: 95.0

transformer_detection:
  enabled: true
  method: "heatmap_threshold"
  threshold_percentile: 90
  min_region_size: 50
  fallback_to_full_frame: true

composite_temperature:
  method: "weighted_average"
  enabled: false  # Deprecated, use transformer_detection

# Pi Camera Configuration
pi_camera:
  enabled: true
  model: "Pi Camera 3"
  resolution: [1920, 1080]
  framerate: 30
  quality: 85
  
  motion_detection:
    enabled: true
    threshold: 1500
    min_area: 500
    
  recording:
    pre_record_seconds: 10
    post_record_seconds: 10
    max_duration_seconds: 300
    
  snapshot_interval: 1800  # 30 minutes
  
  night_mode:
    enabled: true
    start_hour: 18
    end_hour: 6
    ir_leds_enabled: false
    
  storage:
    max_local_storage_gb: 5  # Reduced - using FTP for cold storage
    video_retention_hours: 4  # Keep videos for 4 hours only (uploaded to FTP after 2 hours)
    snapshot_retention_hours: 24  # Keep snapshots for 24 hours (uploaded to FTP after 12 hours)
    
  live_view:
    enabled: false  # Disable by default to save bandwidth
    port: 5000
    require_auth: false  # Disable for testing
    username: "admin"
    password: "admin"

# Event Detection & Classification
event_detection:
  enabled: true
  sensitivity: "medium"  # low, medium, high

  maintenance_visit:
    detection_hours: "08:00-17:00"
    detection_days: ["monday", "tuesday", "wednesday", "thursday", "friday"]
    min_duration_seconds: 120
    min_object_size_percent: 30

  security_breach:
    alert_enabled: true
    alert_hours: "18:00-07:00"  # Alert only during these hours
    alert_days: ["saturday", "sunday"]

  animal:
    max_duration_seconds: 30
    max_object_size_percent: 20

  storage:
    keep_hours: 48  # Keep event images locally for 48 hours (then upload to FTP)
    max_events_per_day: 100
    video_retention_hours: 4  # Keep videos for 4 hours (then upload to FTP)

  performance:
    frame_skip: 3  # Process every Nth frame (1=all frames, 3=every 3rd)
    motion_detection_resolution: [640, 480]  # Lower resolution for motion detection
    sleep_between_checks: 0.1  # Seconds to sleep between motion checks
    low_risk_hours:
      enabled: false  # Disable detection during low-risk hours
      start_hour: 2  # Start of low-risk period (2 AM)
      end_hour: 5    # End of low-risk period (5 AM)
    cpu_monitoring:
      enabled: true
      log_interval: 300  # Log CPU/memory every 5 minutes

  cloud_publishing:
    enabled: true  # Enable publishing to AWS IoT Core (requires AWS config)
    publish_all_events: false  # If false, only publish based on event type settings
    event_topic: "transformers/{thing_name}/events"  # MQTT topic for events

    # Per-event type publishing settings
    maintenance_visit:
      publish_telemetry: true  # Publish event metadata to IoT Core
      upload_images: false     # Don't upload images (save bandwidth, telemetry sufficient)

    security_breach:
      publish_telemetry: true  # ALWAYS publish security events (HIGH PRIORITY)
      upload_images: true      # ALWAYS upload security images (evidence)

    animal:
      publish_telemetry: false  # Don't publish animal events (too frequent, low value)
      upload_images: false      # Don't upload animal images

# Data Capture
data_capture:
  interval: 60  # 1 minute
  save_full_frame_interval: 10
  buffer_size: 100

<<<<<<< HEAD
# Thermal Data Publishing to AWS
thermal_publishing:
  enabled: true  # Enable publishing thermal data to AWS IoT Core

  telemetry:
    publish_interval: 60  # Publish every 60 seconds (aligns with capture_interval)
    include_roi_details: true  # Include individual ROI temperatures
    include_frame_stats: false  # Don't send full frame stats (reduce bandwidth)

  alerts:
    publish_immediately: true  # Publish immediately when alert threshold exceeded
    alert_levels: ["warning", "critical", "emergency"]  # Which levels to publish

  thermal_images:
    upload_to_s3: true  # Upload thermal frames to S3
    upload_on_alert: true  # Upload when temperature alert occurs
    upload_periodic: false  # Don't upload periodic frames (saves bandwidth)
    alert_levels: ["critical", "emergency"]  # Only upload for these levels

=======
>>>>>>> fix/pi4-mlx90640
# Local Storage
local_storage:
  enabled: true
  database_path: "/data/buffer/readings.db"
  max_size_mb: 500
  retention_days: 2  # Keep only 2 days locally (rest goes to FTP)

# FTP Cold Storage (for bulk data - videos, thermal frames, etc.)
ftp_storage:
  enabled: true  # Enable FTP for cold storage
  host: "{{FTP_HOST}}"
  port: 21
  username: "{{FTP_USERNAME}}"
  password: "{{FTP_PASSWORD}}"
  remote_dir: "/transformer_data/{{SITE_ID}}"
  passive: true

  # What to upload and when
  upload_rules:
    videos:
      enabled: true
      upload_after_hours: 2  # Upload videos after 2 hours (free up SD card fast)
      delete_after_upload: true  # Delete local copy after successful upload
      retention_days: 30  # Keep on FTP for 30 days

    thermal_frames:
      enabled: true
      upload_after_hours: 6  # Upload thermal frames after 6 hours
      delete_after_upload: true
      retention_days: 90  # Keep on FTP for 90 days

    event_images:
      enabled: true
      upload_after_hours: 24  # Upload event images after 24 hours
      delete_after_upload: true
      retention_days: 90  # Keep on FTP for 90 days
      skip_security_breach: true  # Don't upload security images to FTP (use AWS S3)

    periodic_snapshots:
      enabled: true
      upload_after_hours: 12  # Upload snapshots after 12 hours
      delete_after_upload: true
      retention_days: 30  # Keep on FTP for 30 days

    animal_events:
      enabled: true
      upload_immediately: true  # Upload animal events immediately (don't store locally)
      delete_after_upload: true
      retention_days: 14  # Keep on FTP for 14 days

  # Upload scheduling
  upload_interval: 300  # Check for files to upload every 5 minutes
  max_upload_retries: 3
  retry_delay: 60  # Retry after 60 seconds on failure

# AWS IoT Core Configuration
aws_iot:
  enabled: false  # Set to true when ready to connect
  endpoint: ""  # e.g., xxxxx-ats.iot.us-east-1.amazonaws.com
  thing_name: ""  # e.g., transformer-monitor-SITE_001
  certs_dir: "/data/certs"
  telemetry_interval: 60  # seconds (1 minute)
  heartbeat_interval: 300  # seconds (5 minutes)
  compression: true  # Compress MQTT payloads (50-70% reduction)
  bandwidth_limit_kbps: 50  # Bandwidth throttling limit

# FTP Configuration
ftp:
  enabled: true
  host: "ftp.example.com"
  port: 21
  username: "user"
  password: "password"
  remote_dir: "/transformer-data"
  passive_mode: true
    
  # Upload intervals
  thermal_image_interval: 600  # 10 minutes
  telemetry_upload_interval: 300  # 5 minutes
  batch_telemetry: true
  organize_by_date: true
  upload_on_alert: true

# Web Interface Configuration
web_interface:
  enabled: true
  live_streaming: false
  on_demand_refresh_interval: 30
  image_cache_duration: 10

# Data Format Settings
data_format:
  timestamp_format: "iso8601"
  timezone: "UTC"

# Media Settings
media:
  thermal_images:
    colormap: "hot"  # Options: hot, jet, inferno, turbo, rainbow
    resolution: [640, 480]  # Upscaled from 32x24
    quality: 90  # JPEG quality (0-100)
    
  visual_images:
    quality: 85
    add_timestamp: true
    
  videos:
    upload_after_recording: true
    keep_local_days: 1  # Delete after 1 day if uploaded successfully

# Network (for testing)
network:
  router:
    local_ip: "192.168.1.1"
  pi:
    static_ip: "192.168.1.100"
  connectivity:
    check_interval: 60

# Heartbeat
heartbeat:
  enabled: true
  interval: 300  # 5 minutes

# Logging
logging:
  level: "INFO"
  max_file_size_mb: 10
  backup_count: 5
  log_to_console: true